import{_ as ae,x as N,y as te,r as i,z as se,g as le,c as u,b as d,f as x,t as $,e as p,w as R,i as c,R as j,l as n,F as oe,s as ie,m as V,n as U,p as T,a as ne,o as l,j as A,k as q,v as z,C as ue}from"./index-CDsh9h_7.js";import{c as de,e as re,a as me,F as ce,b as H}from"./index.esm-DDllFRrV.js";import{_ as ve}from"./ComboItems-ifK7GnC5.js";import{r as pe}from"./NoSymbolIcon-BDiQSZAV.js";import{r as Y}from"./ArrowPathIcon-BuiWCPep.js";import{r as fe}from"./ArrowUpTrayIcon-DE3sg1CW.js";import{r as ye}from"./XMarkIcon-Ot23MzQE.js";import"./default-item-BsiDVC9R.js";const be={class:"bg-screen flex items-center justify-end add-edit-form"},ge={class:"w-full h-5/6 shadow-2xl mx-4 sm:mx-6 md:mx-6 lg:mx-10 py-3 sm:py-4 md:py-5 px-4 sm:px-8 md:px-10 flex flex-col sm:flex-row",style:{background:"rgb(250, 200, 200, 0.25)","min-width":"300px"}},he={class:"w-full sm:w-96 flex-none"},xe={class:"main-title"},ke={class:"auth-detail"},_e={key:0,class:"input-shimmer"},Ce={key:2,class:"error-message"},we={key:3,class:"input-shimmer"},$e={key:5,class:"quantity-cls font-semibold"},Te={key:6,class:"error-message"},Ae={key:7,for:"today-combo",class:"flex items-center space-x-3"},Ie={key:8,for:"active",class:"flex items-center text-sm sm:text-base space-x-3 mb-5"},Ve={key:9,for:"image",style:{display:"flex"},class:"items-center"},Ue={key:10,class:"relative mt-2 sm:mt-2 md:mt-4 w-16 sm:w-20 md:w-24 h-16 sm:h-20 md:h-24"},Ee=["src"],Pe=["disabled"],Fe={class:"sm:ml-2 md:ml-3 w-full"},Le={key:0,class:"no-data"},Re={key:2,class:"no-data"},De={__name:"AddEditCombo",setup(Me){const E=te(),P=ne(),G=de({Title:me().required().max(50),Price:re().required().min(1).max(1e4).typeError("Price must be a valid number").positive("Price must be greater than zero").test("decimal-check","Price can have up to two decimal places",a=>/^\d+(\.\d{1,2})?$/.test((a==null?void 0:a.toString())||""))}),f=N(()=>{var a;return(a=E==null?void 0:E.params)==null?void 0:a.id}),g=i([]),F=i(),D=i(0),M=i(),r=i([]),k=i(""),_=i(),C=i(!1),L=i(),y=i(),I=i(!1),b=i(),h=i(!1),w=i(!1),o=i(!1),O=a=>{const e=a.target.files[0];e&&(y.value=e,b.value=URL.createObjectURL(e))},J=()=>{b.value=null,y.value=null,L.value.value=null},K=N(()=>{var a;return(a=r.value)!=null&&a.length?r.value.reduce((e,s)=>e+s.price,0):0}),Q=a=>{if(r.value.find(e=>e._id==a._id)){let e=r.value.filter(s=>s._id!==a._id);r.value=[...e]}else r.value.push(a)},S=async()=>{var a;((a=g.value)==null?void 0:a.length)!=M.value&&(D.value++,w.value=!0,await V.get(`${U.listItem}?page=${D.value}&limit=16`).then(({data:e})=>{const s=e.data;M.value=s.totalSubcategories;const t=s.subcategories??[];g.value=[...g.value,...t]}).catch(e=>{var s,t;console.error((t=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:t.message)}).finally(()=>{w.value=!1}))},W=async()=>{h.value=!0;let a=new FormData;a.append("name",k.value),a.append("price",_.value),a.append("isTodayMenu",C.value),y.value&&a.append("image",y.value),r.value.forEach((e,s)=>a.append(`subCategories[${s}]`,e._id)),await V.post(U.createCombo,a,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{T.success("Combo created successfully!!"),P.push("/combo")}).catch(e=>{var s,t;T.error((t=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:t.message)}).finally(()=>{h.value=!1})},X=async()=>{h.value=!0;let a=new FormData;a.append("name",k.value),a.append("price",_.value),a.append("isTodayMenu",C.value),a.append("isActive",I.value),(y.value||!b.value&&!y.value)&&a.append("image",y.value),r.value.forEach((e,s)=>a.append(`subCategories[${s}]`,e._id)),await V.put(`${U.updateCombo}${f.value}`,a,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{T.success("Combo updated successfully!!"),P.push("/combo")}).catch(e=>{var s,t;T.error((t=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:t.message)}).finally(()=>{h.value=!1})},Z=async()=>{o.value=!0,await V.get(`${U.getCombo}${f.value}`).then(({data:a})=>{let e=a.data;k.value=e.name,_.value=e.price,C.value=e.isTodayMenu,I.value=e.isActive,b.value=e.image,r.value=e.subCategories}).catch(a=>{var e,s;T.error((s=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:s.message),P.push("/combo")}).finally(()=>{o.value=!1})},ee=()=>{const a=F.value;a&&a.scrollHeight-a.scrollTop<=a.clientHeight+50&&!w.value&&S()};return se(f,()=>{f.value&&Z()},{immediate:!0}),le(()=>{S(),F.value.addEventListener("scroll",ee)}),(a,e)=>{var s;return l(),u("section",be,[d("div",ge,[d("div",he,[d("h1",xe,$(f.value?"Update ":"Add ")+" Combo",1),d("p",ke,[e[8]||(e[8]=p(" Make Combo, A perfect mix of tasty snacks and hearty meals. ")),x(c(j),{to:"/combo",class:"route-link"},{default:R(()=>e[7]||(e[7]=[p("Back to Combo list")])),_:1})]),x(c(ce),{onSubmit:e[6]||(e[6]=t=>f.value?X():W()),"validation-schema":c(G)},{default:R(({errors:t})=>{var m,B;return[e[12]||(e[12]=d("label",{for:"title"},"Title",-1)),o.value?(l(),u("p",_e)):n("",!0),o.value?n("",!0):(l(),A(c(H),{key:1,modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=v=>k.value=v),type:"text",name:"Title",id:"title",class:"input",placeholder:"Enter Your Title"},null,8,["modelValue"])),o.value?n("",!0):(l(),u("p",Ce,$(t==null?void 0:t.Title),1)),e[13]||(e[13]=d("label",{for:"price"},"Price",-1)),o.value?(l(),u("p",we)):n("",!0),o.value?n("",!0):(l(),A(c(H),{key:4,modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=v=>_.value=v),type:"number",name:"Price",id:"price",class:"input",placeholder:"Enter Your Price"},null,8,["modelValue"])),(m=r.value)!=null&&m.length&&!o.value?(l(),u("p",$e," Total price of selected item : "+$(K.value),1)):n("",!0),o.value?n("",!0):(l(),u("p",Te,$(t==null?void 0:t.Price),1)),o.value?n("",!0):(l(),u("label",Ae,[q(d("input",{"onUpdate:modelValue":e[2]||(e[2]=v=>C.value=v),type:"checkbox",id:"today-combo",class:"w-4 h-4 cursor-pointer"},null,512),[[z,C.value]]),e[9]||(e[9]=p(" Is Add on Today's Special Combo? "))])),!o.value&&f.value?(l(),u("label",Ie,[q(d("input",{"onUpdate:modelValue":e[3]||(e[3]=v=>I.value=v),type:"checkbox",id:"active",class:"w-4 h-4 cursor-pointer"},null,512),[[z,I.value]]),e[10]||(e[10]=p(" Available "))])):n("",!0),o.value?n("",!0):(l(),u("label",Ve,[e[11]||(e[11]=p(" Upload Image ")),b.value?n("",!0):(l(),A(c(fe),{key:0,class:"upload-button mx-2",onClick:e[4]||(e[4]=v=>L.value.click())})),d("input",{type:"file",accept:"image/*",ref_key:"file",ref:L,hidden:"",onChange:O},null,544)])),b.value&&!o.value?(l(),u("div",Ue,[x(c(ye),{class:"remove-image",onClick:e[5]||(e[5]=v=>J())}),d("img",{src:b.value,alt:"Uploaded Image",class:"uploaded-img-box"},null,8,Ee)])):n("",!0),d("button",{type:"submit",disabled:h.value||o.value||((B=g.value)==null?void 0:B.length)==0},[p($(f.value?"Edit ":"Add ")+" Combo ",1),h.value?(l(),A(c(Y),{key:0,class:"loading-btn"})):n("",!0)],8,Pe)]}),_:1},8,["validation-schema"])]),d("div",Fe,[d("div",{ref_key:"scrollComponent",ref:F,class:"flex flex-nowrap sm:flex-wrap items-start justify-start overflow-x-auto sm:overflow-y-auto h-full"},[((s=g.value)==null?void 0:s.length)==0&&!w.value&&!o.value?(l(),u("div",Le,[x(c(pe),{class:"no-data-icon"}),e[15]||(e[15]=p(" No Item Available ")),x(c(j),{to:"/item/add-item",class:"route-link ml-2"},{default:R(()=>e[14]||(e[14]=[p(" Add items")])),_:1})])):o.value?n("",!0):(l(!0),u(oe,{key:1},ie(g.value,t=>(l(),A(ve,{key:t,item:t,onAddItem:m=>Q(t),isRemove:r.value.find(m=>(m==null?void 0:m._id)==(t==null?void 0:t._id)),class:ue({"active-item relative":r.value.find(m=>(m==null?void 0:m._id)==(t==null?void 0:t._id))})},null,8,["item","onAddItem","isRemove","class"]))),128)),w.value||o.value?(l(),u("div",Re,[x(c(Y),{class:"loading-btn"}),e[16]||(e[16]=p(" Loading... "))])):n("",!0)],512)])])])}}},Ge=ae(De,[["__scopeId","data-v-ac0a9e39"]]);export{Ge as default};
